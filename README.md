# PHPのフレームワークはどんな形をするのか

この小さいリポジトリではPHPフレームワークの仕組みを理解するためにPsrに互換性のあるパッケージを使ってマイクロフレームワークを作ってみた。

## イントロダクション

依存性の注入とはとは、あるオブジェクトや関数が、依存する他のオブジェクトや関数を受け取るデザインパターンである。  
ユーザーはビジネス上の機能をクラスで実装する。当然、そかのクラスの機能を使ったりするのが普通(これが外部への依存)。  
フレームワークはそれらのクラスを実例化する役割がある。  
そこで、フレームワークはどのようにユーザーが書いた外部に依存したクラスを実例化するのかという疑問が生じる。  
それが依存性の注入の出番。  
もちろん、依存性の注入だけではフレームワークとして機能できないが、しかし、依存性の注入を実装することで

* テストがしやすくなる
* オブジェクト間の依存関係が明瞭になる
* オブジェクトの再利用性が向上する

現代的なフレームワークは大体以下のような機能構造でリクエストを受け、リスポンスを作る。

* dependency injection
* routing
* middleware
* request handler
* emitter

## このプロジェクトで使ったパッケージ

1. php-di/phpdi
2. middlewares/fast-route
3. middlewares/request-handler
4. relay/relay
5. narrawspark/http-emitter
6. laminas/laminas-diactoros

## 基本的な流れ

まず、依存性の注入のための容器を作る。それから、容器にユーザーの書いたクラスを注入する。オブジェクトを作る時に必要な外部の依存もこの時にセッティングして入れる。

続いて、ルート・ディスパチャーをセッティングする。個々のURLをユーザーの書いたどのクラスで対応するかを設置する。

続いて、ミドルウェアに関するセッティングをする。ルート・ディスパチャーをミドルウェアに入れる。
後からくるリクエストハンドラーに繋がるようにリクエスハンドラーに互換を持つパーツをもミドルウェアに入れる。
ここで見れるように、ミドルウェアは**ルートからのもの受け取り、ディスパチャーに渡るという繋がりの役割**をする。

続いて、リクエストハンドラーで実際のURIをハンドルする。ここはようやくユーザーの書いたコードが実行される。

最後に、健全なリスポンスを作る。

そしてもう一つ、陰で大きな役割をする*laminas/laminas-diactoros*。リクエスオブジェクトと基本的なリスポンスのオブジェクトを作る。
